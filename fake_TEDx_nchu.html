<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>google map api</title>
		<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/semantic-ui/1.11.6/semantic.min.css">
		<link href='http://fonts.googleapis.com/css?family=Satisfy' rel='stylesheet' type='text/css'>
		<link rel="shortcut icon" type="image/x-icon" href="img/icon.ico">
		<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAlnBXptn-Zoq7AevGcsPj3XjuuKnnBx7g"></script>
		<style>
			html,body {
				font-family: 'Arial','Microsoft JhengHei';
				height: 100%;
				width: 100%;
				margin: 0;
				padding: 0;
			}
			.google_map {
				height: 600px;
			}
			#map-canvas {
				height: 100%;
				width: 100%;
			}
			#map_top {
				padding-top: 50px;
			}
			#detail_text {
				font-size: 20px;
			}
		</style>
	</head>
	<body>
		<div class="ui top fixed menu">
			<div class="item">
				<img src="img/icon.ico">
			</div>
			<a class="item">短講地圖</a>
			<a class="item">申請方式</a>
			<a class="item">聯絡我們</a>
		</div>
		<div class="ui stackable grid" id="map_top">
			<div class="two wide column"></div>
			<div class="eight wide column">
				<div class="ui segment google_map">
					<div id="map-canvas"></div>
				</div>
			</div>
			<div class="four wide column" id="detail_text">
				<div class="ui grid">
					<div class="four wide column">主題</div>
					<div class="twelve wide column" id="talk_topics">None</div>
					<div class="four wide column">講者</div>
					<div class="twelve wide column" id="talk_speaker">None</div>
					<div class="four wide column">時間</div>
					<div class="twelve wide column" id="talk_time">None</div>
					<div class="four wide column">地點</div>
					<div class="twelve wide column" id="talk_location">None</div>
					<div class="four wide column">介紹</div>
					<div class="twelve wide column" id="talk_detail">None</div>
				</div>
			</div>
		</div>

		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.1.6/components/accordion.js"></script>
		<script type="text/javascript">
			jQuery(document).ready(function($) {
				function initialize() {
					var api_url = "https://script.google.com/macros/s/AKfycbwy6WFg_iyQFNWgcsS8G5u6AbPcm870eK_PPTYmJprENct7Mye4/exec"
					$.get(api_url, "get", function(json){
						// console.log(json.output[1]);
						var input = json.output;
						var markers =[];
						var map = new google.maps.Map(
							document.getElementById('map-canvas'),{
								center: { lat: 24.121468, lng: 120.675867},
								zoom: 17,
								disableDefaultUI: true,
						});
						var icon = ['http://flat-icon-design.com/f/f_traffic_45/s32_f_traffic_45_0nbg.png',
									'http://flat-icon-design.com/f/f_traffic_45/s32_f_traffic_45_1nbg.png',
									'http://flat-icon-design.com/f/f_traffic_45/s32_f_traffic_45_2nbg.png'];
						var talk_details = [];
						var last_marker;
						input.forEach(function(input_data, i){
							markers.push(new google.maps.Marker({
								position: {lat: input_data.lat, lng: input_data.lng},
								map: map,
								icon: icon[input_data.type],
								animation: google.maps.Animation.DROP,
							}));
							talk_details.push({
								topics: input_data.topics,
								speaker: input_data.speaker,
								time: input_data.time,
								location: input_data.location,
								detail: input_data.detail
							});
						});
						markers.forEach(function(marker, i){
							marker.addListener('click', function() {
								detail_show(i);
								if (marker.getAnimation() === null) {
									marker.setAnimation(google.maps.Animation.BOUNCE);
									if (last_marker !== undefined)
										markers[last_marker].setAnimation(null);
									last_marker = i;
								}
							});
						});
						function detail_show(i){
							$('#talk_topics').text(talk_details[i].topics);
							$('#talk_speaker').text(talk_details[i].speaker);
							$('#talk_time').text(talk_details[i].time);
							$('#talk_location').text(talk_details[i].location);
							$('#talk_detail').text(talk_details[i].detail);
						}
						detail_show(0);
					});
				};
				google.maps.event.addDomListener(window, 'load', initialize);
			});
		</script>
	</body>
</html>
